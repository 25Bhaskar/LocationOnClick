<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Share My Location</title>
  <style>
    body {
      font-family: system-ui, Arial, sans-serif;
      margin: 0;
      padding: 24px;
      display: grid;
      place-items: center;
      min-height: 100vh;
      background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=1470&q=80') no-repeat center center/cover;
    }
    .card {
      background: rgba(255, 255, 255, 0.9);
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.08);
      width: 100%;
      max-width: 540px;
      position: relative;
    }
    h2 { margin: 0 0 12px; }
    p { margin: 0 0 16px; line-height: 1.5; color: #444; }
    input, button { font-size: 14px; }
    .row { display: flex; gap: 8px; margin-bottom: 12px; }
    .row input { flex: 1; padding: 12px; border-radius: 8px; border: 1px solid #ddd; }
    .btn { padding: 8px 12px; border: 0; border-radius: 8px; cursor: pointer; transition: 0.2s; font-weight: 600; }
    .btn-save { background: #1976d2; color: #fff; }
    .btn-check { background: #6c757d; color: #fff; }
    .btn-share { background: #25D366; color: #fff; width: 100%; opacity: 0.6; pointer-events: none; }
    .btn-share.active { opacity: 1; pointer-events: auto; }
    .note { font-size: 13px; color: #666; margin-top: 8px; }
    .status { margin-top: 12px; font-size: 14px; color: #111; }
    .error { color: #b00020; }
    .ok { color: #0a7a32; }
    #contactList { margin-top: 16px; font-size: 14px; background: #f9f9f9; padding: 10px; border-radius: 8px; display: none; }
    #contactList ul { padding: 0; margin: 0; list-style: none; }
    #contactList li { padding: 6px 0; border-bottom: 1px solid #ddd; display: flex; justify-content: space-between; align-items: center; }
    .btn-send { background: #25D366; color: #fff; border-radius: 8px; border: none; cursor: pointer; transition: 0.2s; padding: 6px 12px; font-size: 12px; }
    .btn-send.delete { background: #f44336; }
    .btn-send:hover { opacity: 0.9; }
    #translateBtn { position: absolute; top: 5px; background: #ff9800; color: #fff; border-radius: 8px; border: none; cursor: pointer; display: flex; align-items: center; gap: 6px; font-weight: 600; }
    #translateBtn img { width: 18px; height: 18px; }
    @media (max-width: 480px) {
      #translateBtn { position: relative; top: 0; right: 0; margin-bottom: 12px; width: 100%; justify-content: center; }
      .card { padding-top: 12px; }
    }
  </style>
</head>
<body>
  <div class="card">
    <button id="translateBtn" onclick="toggleLanguage()">
      <img src="https://img.icons8.com/ios-filled/50/ffffff/language.png" alt="Translate Icon" /> à¤¹à¤¿à¤‚à¤¦à¥€
    </button>

    <h2 id="title">Send My Live Location on WhatsApp</h2>
    <p class="note" id="note">Requires location permission from your device</p>
    <p id="description">Enter details and share live location instantly.</p>

    <div class="row">
      <input id="name" type="text" placeholder="Enter Name (optional)" />
    </div>
    <div class="row">
      <!-- âœ… Placeholder updated -->
      <input id="phone" type="tel" placeholder="Enter mobile number" inputmode="tel" />
    </div>
    <div class="row">
      <button class="btn btn-save" onclick="saveContact()" id="btnSave">Save Contact</button>
      <button class="btn btn-check" onclick="showContacts()" id="btnCheck">Check Saved Contacts</button>
    </div>

    <button id="shareBtn" class="btn btn-share">Share Location</button>

    <div class="row" style="margin-top: 10px; align-items: center;">
      <button id="papaBtn" onclick="callPapa()" style="background:#d32f2f; color:#fff; padding:8px 12px; border-radius:8px; border:none; font-weight:600; cursor:pointer;">
        ðŸ“ž Emergency
      </button>
      <!-- âœ… Emergency field updated -->
      <input id="papaNumber" type="tel" placeholder="Enter mobile number" inputmode="tel" style="flex:1; padding:8px; border-radius:6px; border:1px solid #ddd; margin-left:8px;" />
      <button id="papaEditBtn" class="btn btn-check">Edit</button>
      <button id="papaSaveBtn" class="btn btn-save" style="display:none;">Save</button>
    </div>

    <div id="status" class="status"></div>
    <div id="contactList"></div>

    <button id="recentBtn" onclick="callRecent()" style="background:#4caf50; color:#fff; padding:8px 12px; border-radius:8px; border:none; font-weight:600; margin-top:10px; cursor:pointer;">
      ðŸ“ž Call Recently Saved Contact
    </button>
  </div>

<script>
const phoneInput = document.getElementById('phone');
const nameInput = document.getElementById('name');
const shareBtn = document.getElementById('shareBtn');
const contactListDiv = document.getElementById('contactList');
const papaInput = document.getElementById('papaNumber');
const papaBtn = document.getElementById('papaBtn');
const recentBtn = document.getElementById('recentBtn');
const papaEditBtn = document.getElementById('papaEditBtn');
const papaSaveBtn = document.getElementById('papaSaveBtn');

// âœ… Accepts either +91xxxxxxxxxx or 10-digit number
function validatePhone(p){ 
  return /^(\+[1-9]\d{9,14}|[0-9]{10})$/.test(p);
}

// Normalize phone to E.164 format for WhatsApp
function normalizePhone(p){
  p = p.trim();
  if(p.startsWith("+")) return p.replace(/\D/g,"");  // keep as is but strip non-digits
  if(/^[0-9]{10}$/.test(p)) return "91" + p;        // default to India +91
  return p.replace(/\D/g,""); 
}

function validateInput(){ 
  if(validatePhone(phoneInput.value.trim())) shareBtn.classList.add('active'); 
  else shareBtn.classList.remove('active'); 
}
phoneInput.addEventListener('input',validateInput);

function flashStatus(msg,isError=false,duration=3000){
  const el=document.getElementById('status');
  el.textContent=msg;
  el.className='status '+(isError?'error':'ok');
  setTimeout(()=>{el.textContent='';},duration);
}

function shareLocation(phone){
  if(!validatePhone(phone)){flashStatus("Enter valid number",true); return;} 
  if(!('geolocation' in navigator)){flashStatus("Geolocation not supported",true); return;} 
  flashStatus("Getting locationâ€¦"); 
  navigator.geolocation.getCurrentPosition(pos=>{
    const lat=pos.coords.latitude.toFixed(6); 
    const lng=pos.coords.longitude.toFixed(6); 
    const mapsLink=`https://maps.google.com/?q=${lat},${lng}`; 
    const msg=`My current location is: ${mapsLink}`; 
    const normalized = normalizePhone(phone);
    setTimeout(()=>{ window.location.href=`https://wa.me/${normalized}/?text=${encodeURIComponent(msg)}` }, 100);
    flashStatus("Opening WhatsAppâ€¦");
  },err=>{flashStatus("Location error",true);});
}
</script>
</body>
</html>
